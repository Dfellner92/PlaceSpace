{"ast":null,"code":"import _slicedToArray from\"/Users/danielfellner/Desktop/postBootcampProjects/Frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useCallback,useEffect}from'react';var logoutTimer;export var useAuth=function useAuth(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),token=_useState2[0],setToken=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),tokenExpirationDateState=_useState4[0],setTokenExpirationDateState=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),userId=_useState6[0],setUserId=_useState6[1];var login=useCallback(function(uid,token,expirationDate){setToken(token);setUserId(uid);var tokenExpirationDate=expirationDate||new Date(new Date().getTime()+1000*60*60);setTokenExpirationDateState(tokenExpirationDate);localStorage.setItem('userData',JSON.stringify({userId:uid,token:token,expiration:tokenExpirationDate.toISOString()}));},[]);var logout=useCallback(function(){setToken(null);setTokenExpirationDateState(null);setUserId(null);localStorage.removeItem('userData');},[]);useEffect(function(){if(token&&tokenExpirationDateState){var remainingTime=tokenExpirationDateState.getTime()-new Date().getTime();logoutTimer=setTimeout(logout,remainingTime);}else{clearTimeout(logoutTimer);}},[token,logout,tokenExpirationDateState]);// make sure useEffect is after login,\n// still synchronous\nuseEffect(function(){var storedData=JSON.parse(localStorage.getItem('userData'));if(storedData&&storedData.token&&new Date(storedData.expiration)>new Date()){login(storedData.userId,storedData.token,new Date(storedData.expiration));}},[login]);return{token:token,login:login,logout:logout,userId:userId};};","map":{"version":3,"sources":["/Users/danielfellner/Desktop/postBootcampProjects/Frontend/src/shared/hooks/auth-hook.js"],"names":["useState","useCallback","useEffect","logoutTimer","useAuth","token","setToken","tokenExpirationDateState","setTokenExpirationDateState","userId","setUserId","login","uid","expirationDate","tokenExpirationDate","Date","getTime","localStorage","setItem","JSON","stringify","expiration","toISOString","logout","removeItem","remainingTime","setTimeout","clearTimeout","storedData","parse","getItem"],"mappings":"iLAAA,OAASA,QAAT,CAAmBC,WAAnB,CAAgCC,SAAhC,KAAiD,OAAjD,CAEA,GAAIC,CAAAA,WAAJ,CAEA,MAAO,IAAMC,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,EAAM,eACCJ,QAAQ,CAAC,KAAD,CADT,wCAClBK,KADkB,eACXC,QADW,8BAEuCN,QAAQ,EAF/C,yCAElBO,wBAFkB,eAEQC,2BAFR,8BAGGR,QAAQ,CAAC,KAAD,CAHX,yCAGlBS,MAHkB,eAGVC,SAHU,eAKzB,GAAMC,CAAAA,KAAK,CAAGV,WAAW,CAAC,SAACW,GAAD,CAAMP,KAAN,CAAaQ,cAAb,CAAgC,CACxDP,QAAQ,CAACD,KAAD,CAAR,CACAK,SAAS,CAACE,GAAD,CAAT,CACA,GAAME,CAAAA,mBAAmB,CAAGD,cAAc,EAAI,GAAIE,CAAAA,IAAJ,CAAS,GAAIA,CAAAA,IAAJ,GAAWC,OAAX,GAAuB,KAAO,EAAP,CAAY,EAA5C,CAA9C,CACAR,2BAA2B,CAACM,mBAAD,CAA3B,CACAG,YAAY,CAACC,OAAb,CACE,UADF,CAEEC,IAAI,CAACC,SAAL,CAAe,CACbX,MAAM,CAAEG,GADK,CAEbP,KAAK,CAAEA,KAFM,CAGbgB,UAAU,CAAEP,mBAAmB,CAACQ,WAApB,EAHC,CAAf,CAFF,EAQD,CAbwB,CAatB,EAbsB,CAAzB,CAeA,GAAMC,CAAAA,MAAM,CAAGtB,WAAW,CAAC,UAAM,CAC/BK,QAAQ,CAAC,IAAD,CAAR,CACAE,2BAA2B,CAAC,IAAD,CAA3B,CACAE,SAAS,CAAC,IAAD,CAAT,CACAO,YAAY,CAACO,UAAb,CAAwB,UAAxB,EACD,CALyB,CAKvB,EALuB,CAA1B,CAOAtB,SAAS,CAAC,UAAM,CACd,GAAIG,KAAK,EAAIE,wBAAb,CAAuC,CACrC,GAAMkB,CAAAA,aAAa,CAAGlB,wBAAwB,CAACS,OAAzB,GAAqC,GAAID,CAAAA,IAAJ,GAAWC,OAAX,EAA3D,CACAb,WAAW,CAAGuB,UAAU,CAACH,MAAD,CAASE,aAAT,CAAxB,CACD,CAHD,IAGO,CACLE,YAAY,CAACxB,WAAD,CAAZ,CACD,CACF,CAPQ,CAON,CAACE,KAAD,CAAQkB,MAAR,CAAgBhB,wBAAhB,CAPM,CAAT,CASA;AACA;AACAL,SAAS,CAAC,UAAM,CACd,GAAM0B,CAAAA,UAAU,CAAGT,IAAI,CAACU,KAAL,CAAWZ,YAAY,CAACa,OAAb,CAAqB,UAArB,CAAX,CAAnB,CACA,GACEF,UAAU,EACVA,UAAU,CAACvB,KADX,EAEA,GAAIU,CAAAA,IAAJ,CAASa,UAAU,CAACP,UAApB,EAAkC,GAAIN,CAAAA,IAAJ,EAHpC,CAIE,CACAJ,KAAK,CAACiB,UAAU,CAACnB,MAAZ,CAAoBmB,UAAU,CAACvB,KAA/B,CAAsC,GAAIU,CAAAA,IAAJ,CAASa,UAAU,CAACP,UAApB,CAAtC,CAAL,CACD,CACF,CATQ,CASN,CAACV,KAAD,CATM,CAAT,CAWA,MAAO,CAAEN,KAAK,CAALA,KAAF,CAASM,KAAK,CAALA,KAAT,CAAgBY,MAAM,CAANA,MAAhB,CAAwBd,MAAM,CAANA,MAAxB,CAAP,CACH,CAlDM","sourcesContent":["import { useState, useCallback, useEffect } from 'react';\n\nlet logoutTimer;\n\nexport const useAuth = () => {\n    const [token, setToken] = useState(false);\n    const [tokenExpirationDateState, setTokenExpirationDateState] = useState();\n    const [userId, setUserId] = useState(false);\n  \n    const login = useCallback((uid, token, expirationDate) => {\n      setToken(token);\n      setUserId(uid);\n      const tokenExpirationDate = expirationDate || new Date(new Date().getTime() + 1000 * 60 * 60);\n      setTokenExpirationDateState(tokenExpirationDate)\n      localStorage.setItem(\n        'userData', \n        JSON.stringify({ \n          userId: uid, \n          token: token,\n          expiration: tokenExpirationDate.toISOString() \n        })\n      );\n    }, []);\n  \n    const logout = useCallback(() => {\n      setToken(null);\n      setTokenExpirationDateState(null);\n      setUserId(null);\n      localStorage.removeItem('userData');\n    }, []);\n  \n    useEffect(() => {\n      if (token && tokenExpirationDateState) {\n        const remainingTime = tokenExpirationDateState.getTime() - new Date().getTime();\n        logoutTimer = setTimeout(logout, remainingTime);\n      } else {\n        clearTimeout(logoutTimer);\n      }\n    }, [token, logout, tokenExpirationDateState])\n  \n    // make sure useEffect is after login,\n    // still synchronous\n    useEffect(() => {\n      const storedData = JSON.parse(localStorage.getItem('userData'));\n      if (\n        storedData && \n        storedData.token &&\n        new Date(storedData.expiration) > new Date()\n      ) {\n        login(storedData.userId, storedData.token, new Date(storedData.expiration));\n      }\n    }, [login]);\n\n    return { token, login, logout, userId };\n}"]},"metadata":{},"sourceType":"module"}